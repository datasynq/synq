import os from 'os'
import fs from 'fs-extra'
import { files, log } from '@qq/utils/basic.js'

// FIXME: should get path from opts...
export const readconfig = async opts => {
	try {
		return JSON.parse(await fs.readFile(files.config, 'utf8'))
	} catch (error) {
		log.error(`Cannot read config file at ${files.config}`)
	}
}

// FIXME: should get path from opts...
export const writeconfig = async(config, opts) => {
	try {
		return await fs.writeFile(files.config, JSON.stringify(config, null, '  ') + os.EOL, 'utf8')
	} catch (error) {
		log.error(`Cannot write config file at ${files.config}`)
	}
}

export const readworking = async() => {
	if (!fs.existsSync(files.working)) {
		await fs.close(await fs.open(files.working, 'w'))
	}
	return (await fs.readFile(files.working, 'utf8')).trim()
}
