import os from 'os'
import fs from 'fs-extra'
import { readconfig } from '@qq/utils/config.js'
import { files, log } from '@qq/utils/basic.js'

export const select_db = async function(name, opts) {
	const { databases } = await readconfig(opts)
	if (databases && databases[name]) {
		await fs.writeFile(files.working, `${name}${os.EOL}`)
		log.out(`Selected "${name}" as working database.`, opts.silent)
	} else {
		throw new Error(`Database "${name}" does not exist.`)
	}
}

export default function(prog) {

	prog
		.command('select <name>', 'Select working local database')
		.action(async(name, opts) => {
			try {
				await select_db(name, opts)
			} catch (error) {
				log.error(error.message)
			}
		})

}
